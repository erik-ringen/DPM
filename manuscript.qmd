---
title: "Causal inference and co-evolutionary contingencies using dynamic phylogenetic models"
format: html
editor: visual
bibliography: references.bib
---

## Introduction

Phylogenetic comparative methods (PCMs) are commonly used to study the co-evolution of traits, spanning topics such as anatomy and physiology [@garland2005phylogenetic; @oconnor2022immunity; @thayer2018impact], life history and behavior [@maclean2012does; @clayton1994comparative; @salguero2016fast; @bielby2007fast; @cornwallis2017cooperation], and cultural evolution [@mace2005phylogenetic; @watts2015broad]. "Co-evolution" refers to repeatable patterns of trait co-variation over evolutionary time, across species or across populations. In practice, co-evolution can be investigated using a diverse family of statistical techniques, depending on the research question and type of data available (Garamszegi, 2014a; Nunn, 2011).

Trait co-evolution simply describes *how* traits change over time. Such descriptions have value for understanding natural history, ancestral state reconstruction (using the present to retrodict the past), and can stimulate new research questions. However, simply inferring that traits changed together in the past does not tell us *why* they changed, or how the traits would respond to intervention, i.e., causality. Nonetheless, researchers in ecology and evolution are often motivated to study trait co-evolution because they believe these patterns reflect causal relations. We briefly review some popular classes of PCM and their limitations with respect to causal inference.

## "Static" PCMs

Phylogenetic generalized least squares is a variant of linear regression that accounts for the covariance between species or populations due to shared evolutionary history (likewise for its predecessor, independent contrasts). The most commonly assumed model of evolution is Brownian motion, where trait X follows a random walk proportional to time ($t$), such that, for any $t$:

$$ E[X] = 0 $$
$$ \textrm{Var}[X] = \sigma^2 t $$
Therefore, the variance for a given species or population $j$ is proportional to total branch length of the tree leading from root to tip, and the covariance between $j$ and any other species or population $k$ is proportional to their amount of shared history. For example, imagine a phylogeny with only $J$ = 3 tip species. The last common ancestor of all species is dated to T = 10,000 years ago, and the last common ancestor of 2 and 3 is dated to 0.5T = 5,000 years ago. The implied phylogenetic variance-covariance matrix ($V$) under a Brownian motion model is thus:

$$ V = \sigma^2 \begin{bmatrix}
T, & 0, & 0 \\
0, & T, & 0.5T \\
0, & 0.5T & T
\end{bmatrix} $$

Thus, the total variance for species 3 is the sum of its evolutionary history, $\sigma^2$[t(1,2,3) - t(2,3)] + $\sigma^2$[t(2,3) - t(3)] and the covariance between species 2 and 3 is equal to the sum of their *shared* evolutionary history $\sigma^2[t(2,3) - t(3)]$, which is always some fraction of the species total evolutionary time $T_j$. So long as the tree is ultrametric (all tips equidistant from the root), $T_j$ = $T ~\forall ~j \in J$. It is easier to interpret $\sigma$ when we first scale all times by the total tree length $T$. We will denote this scaled variance-covariance matrix as $V_s$

$$ V_s = \frac{V}{T} = \sigma^2 \begin{bmatrix}
1, & 0, & 0 \\
0, & 1, & 0.5 \\
0, & 0.5 & 1
\end{bmatrix} $$


While Brownian motion is the simplest case, in general $V$ is constructed using a matrix  

All that is needed is a matrix of phylogenetic distances $D$ (i.e., time since species/populations diverged) and an assumed model of trait evolution (e.g., Brownian motion, Ornstein-Uhlenbeck, Early Burst). 

$$
 Y \sim \mathcal{N}(\boldsymbol{X}\beta, \boldsymbol{\Sigma}) \\
 \boldsymbol{\Sigma} = \sigma^2(1-D) \\
 V = \begin{bmatrix}  \end{bmatrix}
$$

Where $\boldsymbol{X}$ is a design matrix of predictors and $\beta$ is a vector of regression coefficients. The strength of the covariance between related species is controlled by the scalar $\lambda \in [0,1]$. We scale the distance matrix $D$ by the total length of phylogeny so that taking the complement 1 - $D$ gives us the phylogenetic covariance matrix expected under a Brownian motion model.

and an assumed model of trait evolution (e.g., Brownian motion, Ornstein-Uhlenbeck, Early-Burst)

A sample For example,

Phylogenetic generalized multilevel models (PGLMMs) extend this analytic strategy, accommodating more complex, multivariate model designs [@ives2010phylogenetic; @ives2011generalized]. While the terminology is not always consistent in the literature, note that "phylogenetic correlation" refers to a . A residual correlation refers to the remaining trait covariance *after* accounting for similarity due to shared evolutionary history. The residual correlations derived from PCMs are often interpreted as evidence for convergent evolution, adjusted for statistical non-independence and confounding due to phylogeny.

Independent contrasts, PGLS, PGLMMs, PPA

## "Dynamic" PCMs

Pagel's discrete, Hidden Markov Models, Butler & King OU

can be identified statistically as non-zero between-trait phylogenetic correlations----or any other measure of mutual information over evolutionary time.

THREE SCENARIOS TO SIMULATE:

\(1\) Confounding by third variable X_3 -\> X_2, X_3 -\> X_1

\(2\) Correlated drift (CoV\[X_1,X_2\]) != 0)

\(3\) Including correlated drift (shrinking cross-effects)
